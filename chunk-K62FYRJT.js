import{d as ge,e as ze,f as he,g as ve,h as ye,i as Fe,j as be}from"./chunk-PHG3VJEM.js";import"./chunk-HNORQ23J.js";import"./chunk-2SBPQ5PO.js";import{a as Ae,b as Ee,c as xe,d as Se,e as Me}from"./chunk-TS3NV7FJ.js";import{a as ae,b as le,c as se}from"./chunk-Y7V7LVZY.js";import"./chunk-K62VDMMU.js";import{a as K,b as Q}from"./chunk-JLK6BMKQ.js";import"./chunk-3GG5JXOG.js";import{a as de,b as Ce,c as fe}from"./chunk-POH2GVPE.js";import{a as g}from"./chunk-DEEABJD6.js";import{f as me,g as pe,h as ce}from"./chunk-BEYQRRZ4.js";import"./chunk-EWNZSDQ6.js";import{b as _e}from"./chunk-BVLOTES5.js";import{$ as re,L as U,M as c,O as X,P as Z,S as ee,T as te,V as ie,X as ne,_ as ue,aa as oe}from"./chunk-KM43CBUV.js";import{f as L,g as $,h as W,i as J}from"./chunk-4RJVJPSO.js";import{A as j,q as Y,r as B,x as G,xa as H,ya as q}from"./chunk-7PNVVBYH.js";import"./chunk-MHGKYAZL.js";import"./chunk-FHD2U5CN.js";import{Ca as C,Da as f,Ec as O,Fb as x,Fc as u,Gc as _,H as E,Hc as D,Jc as R,Kc as T,Lb as y,Lc as V,Mc as w,Nc as I,Tb as p,Uc as k,a as b,b as A,dc as h,ec as v,fc as n,gc as t,hc as m,ic as S,jc as M,lc as P,rb as l,rc as F,tc as N,wb as z}from"./chunk-Q7WSBUFH.js";var Re=()=>({x:"800px"}),Ne=(r,e)=>e.id,Te=(r,e)=>e.year;function Ve(r,e){r&1&&m(0,"span",20)}function we(r,e){if(r&1&&(n(0,"tr")(1,"td"),u(2),t(),n(3,"td"),u(4),t(),n(5,"td"),u(6),t(),n(7,"td"),u(8),t(),n(9,"td"),u(10),t(),n(11,"td",21)(12,"button",22),u(13," \u0648\u06CC\u0631\u0627\u06CC\u0634 "),t()()()),r&2){let i=e.$implicit;l(2),_(i.party_name),l(2),_(i.fin_year),l(2),D("",i.detail.percentage,"%"),l(2),_(i.description||"-"),l(2),_(i.date)}}function Ie(r,e){if(r&1&&m(0,"nz-option",28),r&2){let i=e.$implicit;p("nzValue",i.year)("nzLabel",i.year)}}function ke(r,e){if(r&1&&m(0,"nz-option",28),r&2){let i=e.$implicit;p("nzValue",i.id)("nzLabel",i.name)}}function Ye(r,e){if(r&1&&(S(0),n(1,"p",23),u(2,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062C\u062F\u06CC\u062F\u06CC \u0628\u0647 \u0633\u06CC\u0633\u062A\u0645 \u0627\u0636\u0627\u0641\u0647 \u06A9\u0646\u06CC\u062F"),t(),n(3,"form",24)(4,"nz-form-item")(5,"nz-form-label",25),u(6,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),t(),n(7,"nz-form-control",26)(8,"nz-select",27),h(9,Ie,1,2,"nz-option",28,Te),t()()(),n(11,"nz-form-item")(12,"nz-form-label",25),u(13,"\u0645\u0646\u0637\u0642\u0647 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),t(),n(14,"nz-form-control",29)(15,"nz-select",30),h(16,ke,1,2,"nz-option",28,Ne),t()()(),n(18,"nz-form-item")(19,"nz-form-label",25),u(20,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0647\u0632\u06CC\u0646\u0647 (%)"),t(),n(21,"nz-form-control",31),m(22,"input",32),t()(),n(23,"nz-form-item")(24,"nz-form-label"),u(25,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),t(),n(26,"nz-form-control"),m(27,"textarea",33),t()()(),M()),r&2){let i=N();l(3),p("formGroup",i.fundForm),l(6),v(i.financialYears),l(7),v(i.regions)}}var Pe=class r{constructor(e,i,o){this.fb=e;this.notification=i;this.http=o}isModalVisible=!1;fundForm;AREA_RESERVE_TYPE_ID=4;stats=[{title:"\u06A9\u0644 \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u0645\u0646\u0627\u0637\u0642",value:"0",icon:"percentage"},{title:"\u0645\u06CC\u0627\u0646\u06AF\u06CC\u0646 \u062F\u0631\u0635\u062F",value:"0%",icon:"percentage"},{title:"\u0645\u0646\u0627\u0637\u0642 \u062A\u062D\u062A \u067E\u0648\u0634\u0634",value:"0",icon:"file-text"}];displayReserves=[];financialYears=[];regions=[];contributionApi=g.endpoints.contribution;contributionDetailApi=g.endpoints.contributionDetail;financialYearApi=g.endpoints.financialYear;regionApi=g.endpoints.region;ngOnInit(){this.loadInitialData(),this.fundForm=this.fb.group({fin_year:[null,[c.required]],party_id:[null,[c.required]],percentage:[null,[c.required,c.min(0),c.max(100)]],description:[null]})}loadInitialData(){E({contributions:this.http.get(this.contributionApi),details:this.http.get(this.contributionDetailApi),financialYears:this.http.get(this.financialYearApi),regions:this.http.get(this.regionApi)}).subscribe({next:e=>{this.financialYears=e.financialYears,this.regions=e.regions,this.processAndSetDisplayData(e.contributions,e.details)},error:e=>this.handleApiError("\u062F\u0631\u06CC\u0627\u0641\u062A \u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0627\u0648\u0644\u06CC\u0647",e)})}processAndSetDisplayData(e,i){let o=new Map(this.regions.map(a=>[a.id,a.name])),s=e.filter(a=>a.contribution_type_id===this.AREA_RESERVE_TYPE_ID);this.displayReserves=s.map(a=>{let d=i.find(De=>De.contribution_id===a.id),Oe=o.get(a.party_id)||"\u0646\u0627\u0634\u0646\u0627\u062E\u062A\u0647";return A(b({},a),{party_name:Oe,detail:d})}).filter(a=>a.detail),this.updateStats()}updateStats(){this.stats[0].value=this.displayReserves.length.toString();let e=new Set(this.displayReserves.map(i=>i.party_id)).size;if(this.stats[2].value=e.toString(),this.displayReserves.length>0){let o=this.displayReserves.reduce((s,a)=>s+(a.detail.percentage||0),0)/this.displayReserves.length;this.stats[1].value=`${o.toFixed(2)}%`}else this.stats[1].value="0%"}showModal(){this.fundForm.reset(),this.isModalVisible=!0}handleOk(){if(this.fundForm.valid){let e=this.fundForm.value,i={party_type:"region",party_id:e.party_id,fin_year:e.fin_year,contribution_type_id:this.AREA_RESERVE_TYPE_ID,date:new Date().toISOString().split("T")[0],total_amount:0,description:e.description};this.http.post(this.contributionApi,i).subscribe({next:o=>{let s={contribution_id:o.id,party_id:o.party_id,amount:0,percentage:e.percentage,amnt_or_prcntg:!0};this.http.post(this.contributionDetailApi,s).subscribe({next:()=>{this.notification.success("\u0645\u0648\u0641\u0642","\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062C\u062F\u06CC\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0630\u062E\u06CC\u0631\u0647 \u0634\u062F."),this.isModalVisible=!1,this.loadInitialData()},error:a=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u062C\u0632\u0626\u06CC\u0627\u062A \u0633\u0647\u0645",a)})},error:o=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u0633\u0647\u0645 \u0627\u0635\u0644\u06CC",o)})}else Object.values(this.fundForm.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))})}handleApiError(e,i){this.notification.error("\u062E\u0637\u0627",`${e} \u0628\u0627 \u0645\u0634\u06A9\u0644 \u0645\u0648\u0627\u062C\u0647 \u0634\u062F.`),console.error(i)}handleCancel(){this.isModalVisible=!1}static \u0275fac=function(i){return new(i||r)(z(ue),z(_e),z(G))};static \u0275cmp=x({type:r,selectors:[["app-area-reserve-percentage"]],features:[w([Y])],decls:44,vars:8,consts:[["suffixIconSearch",""],["fundsTable",""],[1,"fund-percentage-page"],[1,"page-header"],[1,"header-title"],[1,"header-actions"],[1,"dark-search-input"],["nzSearch","",3,"nzAddOnAfter"],["type","text","nz-input","","placeholder","\u062C\u0633\u062A\u062C\u0648\u06CC \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647..."],["nz-button","","nzType","primary","nzShape","round",3,"click"],["nz-icon","","nzType","plus"],[1,"custom-card"],[1,"custom-card__header"],[1,"custom-card__title"],[1,"custom-card__subtitle"],[1,"custom-card__body"],[1,"financial-table",3,"nzData","nzSize","nzScroll"],[1,"actions-header"],["nzTitle","\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062C\u062F\u06CC\u062F",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzOkText","nzCancelText"],[4,"nzModalContent"],["nz-icon","","nzType","search"],[1,"actions"],["nz-button","","nzShape","round","nzType","primary","nzSize","small"],[1,"modal-subtitle"],["nz-form","",1,"modal-form",3,"formGroup"],["nzRequired",""],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","fin_year","nzPlaceHolder","\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],[3,"nzValue","nzLabel"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0645\u0646\u0637\u0642\u0647 \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","party_id","nzPlaceHolder","\u0645\u0646\u0637\u0642\u0647 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u06CC\u06A9 \u062F\u0631\u0635\u062F \u0645\u0639\u062A\u0628\u0631 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F"],["nz-input","","formControlName","percentage","type","number","placeholder","\u0645\u062B\u0627\u0644: 5.5"],["nz-input","","formControlName","description","placeholder","\u062A\u0648\u0636\u06CC\u062D\u0627\u062A \u0627\u062E\u062A\u06CC\u0627\u0631\u06CC"]],template:function(i,o){if(i&1){let s=P();n(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1"),u(4,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u0645\u0646\u0627\u0637\u0642"),t(),n(5,"p"),u(6,"\u0645\u062F\u06CC\u0631\u06CC\u062A \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0647\u0632\u06CC\u0646\u0647 \u0628\u0631\u0627\u06CC \u0645\u0646\u0627\u0637\u0642 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),t()(),n(7,"div",5)(8,"div",6)(9,"nz-input-group",7),m(10,"input",8),t(),y(11,Ve,1,0,"ng-template",null,0,k),t(),n(13,"button",9),F("click",function(){return C(s),f(o.showModal())}),m(14,"span",10),u(15," \u062F\u0631\u0635\u062F \u062C\u062F\u06CC\u062F "),t()()(),n(16,"div",11)(17,"div",12)(18,"h2",13),u(19,"\u0644\u06CC\u0633\u062A \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u0645\u0646\u0627\u0637\u0642"),t(),n(20,"p",14),u(21," \u062A\u0645\u0627\u0645 \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062A\u0639\u0631\u06CC\u0641 \u0634\u062F\u0647 \u0628\u0631\u0627\u06CC \u0645\u0646\u0627\u0637\u0642 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC "),t()(),n(22,"div",15)(23,"nz-table",16,1)(25,"thead")(26,"tr")(27,"th"),u(28,"\u0645\u0646\u0637\u0642\u0647 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),t(),n(29,"th"),u(30,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),t(),n(31,"th"),u(32,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0647\u0632\u06CC\u0646\u0647"),t(),n(33,"th"),u(34,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),t(),n(35,"th"),u(36,"\u062A\u0627\u0631\u06CC\u062E \u0627\u06CC\u062C\u0627\u062F"),t(),n(37,"th",17),u(38,"\u0639\u0645\u0644\u06CC\u0627\u062A"),t()()(),n(39,"tbody"),h(40,we,14,5,"tr",null,Ne),t()()()()(),n(42,"nz-modal",18),V("nzVisibleChange",function(d){return C(s),T(o.isModalVisible,d)||(o.isModalVisible=d),f(d)}),F("nzOnCancel",function(){return C(s),f(o.handleCancel())})("nzOnOk",function(){return C(s),f(o.handleOk())}),y(43,Ye,28,1,"ng-container",19),t()}if(i&2){let s=O(12);l(9),p("nzAddOnAfter",s),l(14),p("nzData",o.displayReserves)("nzSize","middle")("nzScroll",I(7,Re)),l(17),v(o.displayReserves),l(2),R("nzVisible",o.isModalVisible),p("nzOkText","\u0630\u062E\u06CC\u0631\u0647")("nzCancelText","\u0627\u0646\u0635\u0631\u0627\u0641")}},dependencies:[B,j,re,ee,U,te,X,Z,oe,ie,ne,J,W,L,$,q,H,ce,me,pe,be,ve,ge,ze,Fe,he,ye,fe,Ce,de,Me,Q,K,Ee,Ae,Se,xe,se,ae,le],styles:[".bus-transit-share-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:2rem;height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1.5rem}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0 0}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.dark-search-input[_ngcontent-%COMP%]{min-width:250px}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem;padding:1.5rem;border-radius:8px}.stat-card__icon[_ngcontent-%COMP%]{font-size:2rem}.stat-card__info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-card__title[_ngcontent-%COMP%]{font-size:.9rem}.stat-card__value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600}.custom-card[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.custom-card__body[_ngcontent-%COMP%]{overflow-x:auto}.financial-table[_ngcontent-%COMP%]   .actions-header[_ngcontent-%COMP%]{text-align:center}.financial-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem;flex-wrap:nowrap}.modal-subtitle[_ngcontent-%COMP%]{margin-top:-10px;margin-bottom:24px}"]})};export{Pe as AreaReservePercentageComponent};
