import{a as R}from"./chunk-DEEABJD6.js";import{b as K}from"./chunk-4RJVJPSO.js";import{x as M}from"./chunk-7PNVVBYH.js";import{B as Y,C as A,O as E,T as k,V as z,_c as q,a as c,b as h,ba as T,fa as u,fd as D,g as j,ha as $,i as F,ia as H,l as w,la as p,n as m,o as y,oa as P,p as v,qa as d,r as x,u as O,v as L,x as g,y as C,z as I}from"./chunk-Q7WSBUFH.js";function Q(){return i=>new F(n=>{let t,e,r=new j;return r.add(i.subscribe({complete:()=>{t&&n.next(e),n.complete()},error:o=>{n.error(o)},next:o=>{e=o,t||(t=y.schedule(()=>{n.next(e),t=void 0}),r.add(t))}})),r})}function U(i){return typeof i.ngrxOnStoreInit=="function"}function N(i){return typeof i.ngrxOnStateInit=="function"}var X=new P("@ngrx/component-store Initial State"),B=(()=>{class i{constructor(t){this.destroySubject$=new m(1),this.destroy$=this.destroySubject$.asObservable(),this.stateSubject$=new m(1),this.isInitialized=!1,this.state$=this.select(e=>e),this.state=K(this.stateSubject$.pipe(u(this.destroy$)),{requireSync:!1,manualCleanup:!0}),this.\u0275hasProvider=!1,t&&this.initState(t),this.checkProviderForHooks()}ngOnDestroy(){this.stateSubject$.complete(),this.destroySubject$.next()}updater(t){return e=>{let r=!0,o,a=(I(e)?e:g(e)).pipe(O(v),$(()=>this.assertStateIsInitialized()),H(this.stateSubject$),Y(([l,b])=>t(b,l)),$(l=>this.stateSubject$.next(l)),E(l=>r?(o=l,x):C(l)),u(this.destroy$)).subscribe();if(o)throw o;return r=!1,a}}initState(t){L([t],v).subscribe(e=>{this.isInitialized=!0,this.stateSubject$.next(e)})}setState(t){typeof t!="function"?this.initState(t):this.updater(t)()}patchState(t){let e=typeof t=="function"?t(this.get()):t;this.updater((r,o)=>c(c({},r),o))(e)}get(t){this.assertStateIsInitialized();let e;return this.stateSubject$.pipe(k(1)).subscribe(r=>{e=t?t(r):r}),e}select(...t){let{observablesOrSelectorsObject:e,projector:r,config:o}=Z(t);return(V(e,r)?this.stateSubject$:A(e)).pipe(o.debounce?Q():G(),r?Y(a=>e.length>0&&Array.isArray(a)?r(...a):r(a)):G(),z(o.equal),T({refCount:!0,bufferSize:1}),u(this.destroy$))}selectSignal(...t){let e=[...t],r=typeof e[t.length-1]=="object"?e.pop():{},o=e.pop(),s=e,a=s.length===0?()=>o(this.state()):()=>{let l=s.map(b=>b());return o(...l)};return D(a,r)}effect(t){let e=new w;return t(e).pipe(u(this.destroy$)).subscribe(),r=>(I(r)?r:g(r)).pipe(u(this.destroy$)).subscribe(s=>{e.next(s)})}checkProviderForHooks(){y.schedule(()=>{if(q()&&(U(this)||N(this))&&!this.\u0275hasProvider){let t=[U(this)?"OnStoreInit":"",N(this)?"OnStateInit":""].filter(e=>e);console.warn(`@ngrx/component-store: ${this.constructor.name} has the ${t.join(" and ")} lifecycle hook(s) implemented without being provided using the provideComponentStore(${this.constructor.name}) function. To resolve this, provide the component store via provideComponentStore(${this.constructor.name})`)}})}assertStateIsInitialized(){if(!this.isInitialized)throw new Error(`${this.constructor.name} has not been initialized yet. Please make sure it is initialized before updating/getting.`)}static{this.\u0275fac=function(e){return new(e||i)(d(X,8))}}static{this.\u0275prov=p({token:i,factory:i.\u0275fac})}}return i})();function Z(i){let n=Array.from(i),e={debounce:!1,equal:(s,a)=>s===a};if(_(n[n.length-1])&&(e=c(c({},e),n.pop())),n.length===1&&typeof n[0]!="function")return{observablesOrSelectorsObject:n[0],projector:void 0,config:e};let r=n.pop();return{observablesOrSelectorsObject:n,projector:r,config:e}}function _(i){let n=i;return typeof n.debounce<"u"||typeof n.equal<"u"}function V(i,n){return Array.isArray(i)&&i.length===0&&n}function G(){return i=>i}var f=class i{constructor(n){this.http=n}apiUrl=R.endpoints.financialYear;getAll(){return this.http.get(this.apiUrl)}add(n){return this.http.post(this.apiUrl,{year:n})}delete(n){return this.http.delete(`${this.apiUrl}${n}/`)}static \u0275fac=function(t){return new(t||i)(d(M))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};var S="selectedFinancialYear",te={error:null,isLoading:!1,selectedYear:null,years:[]},J=class i extends B{constructor(t){super(te);this.financialYearService=t;let e=localStorage.getItem(S);e&&this.patchState({selectedYear:+e})}vm=this.selectSignal(t=>t);setSelectedYear=this.updater((t,e)=>(e?localStorage.setItem(S,e.toString()):localStorage.removeItem(S),h(c({},t),{selectedYear:e})));loadYears(t){this.patchState({isLoading:!0,error:null}),this.financialYearService.getAll().subscribe({next:e=>{this.patchState({years:e.sort((r,o)=>r.year-o.year),isLoading:!1}),t?.success?.()},error:e=>{this.patchState({error:e,isLoading:!1}),t?.error?.(e)}})}addYear(t,e){this.patchState({isLoading:!0,error:null}),this.financialYearService.add(t).subscribe({next:r=>{this.patchState(o=>h(c({},o),{years:[...o.years,r].sort((s,a)=>s.year-a.year),isLoading:!1})),e?.success?.(r)},error:r=>{this.patchState({error:r,isLoading:!1}),e?.error?.(r)}})}deleteYear(t,e){this.patchState({isLoading:!0,error:null}),this.financialYearService.delete(t).subscribe({next:()=>{this.patchState(r=>{let o=r.years.filter(a=>a.year!==t),s=r.selectedYear===t?null:r.selectedYear;return s===null&&localStorage.removeItem(S),h(c({},r),{years:o,isLoading:!1,selectedYear:s})}),e?.success?.()},error:r=>{this.patchState({error:r,isLoading:!1}),e?.error?.(r)}})}static \u0275fac=function(e){return new(e||i)(d(f))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{J as a};
