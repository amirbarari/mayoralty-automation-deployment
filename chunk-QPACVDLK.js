import{c as se}from"./chunk-FSSZSAII.js";import{d as _e,e as ze,f as he,g as ve,h as ye,i as be,j as Fe}from"./chunk-WRUICC57.js";import"./chunk-S76HEK6X.js";import"./chunk-2SBPQ5PO.js";import{a as xe,b as Oe,c as Ee,d as Se,e as Me}from"./chunk-YOIS5LYM.js";import{a as oe,b as ae,c as le}from"./chunk-GAPH4TJR.js";import"./chunk-K62VDMMU.js";import{a as J,b as K}from"./chunk-JLK6BMKQ.js";import"./chunk-3GG5JXOG.js";import{a as de,b as Ce,c as fe}from"./chunk-S6C6MKMF.js";import{a as h}from"./chunk-DEEABJD6.js";import{f as me,g as pe,h as ce}from"./chunk-UQPNZCHR.js";import"./chunk-PZ3WQJJL.js";import{b as ge}from"./chunk-R7V4VY4G.js";import{$ as ne,L as Q,M as c,O as U,P as X,T as Z,U as ee,W as te,Y as ie,aa as ue,ba as re}from"./chunk-WURTGZ7Q.js";import{f as q,g as H,h as L,i as W}from"./chunk-4RJVJPSO.js";import{q as Y,r as G,x as B,xa as $,ya as j}from"./chunk-7PNVVBYH.js";import"./chunk-MHGKYAZL.js";import"./chunk-FHD2U5CN.js";import{Ca as C,Da as f,Ec as N,Fb as E,Fc as u,Gc as z,H as O,Hc as D,Jc as T,Kc as R,Lb as y,Lc as V,Mc as w,Nc as I,Tb as p,Uc as k,a as F,b as x,dc as g,ec as _,fc as n,gc as i,hc as m,ic as S,jc as M,lc as P,rb as l,rc as b,tc as A,wb as v}from"./chunk-Q7WSBUFH.js";var Te=()=>({x:"800px"}),Re=(r,e)=>e.title,Ae=(r,e)=>e.id,Ve=(r,e)=>e.year;function we(r,e){r&1&&m(0,"span",22)}function Ie(r,e){if(r&1&&m(0,"app-status-card",12),r&2){let t=e.$implicit;p("icon",t.icon)("title",t.title)("value",t.value)("subtitle","")}}function ke(r,e){if(r&1&&(n(0,"tr")(1,"td"),u(2),i(),n(3,"td"),u(4),i(),n(5,"td"),u(6),i(),n(7,"td"),u(8),i(),n(9,"td"),u(10),i(),n(11,"td",23)(12,"button",24),u(13," \u0648\u06CC\u0631\u0627\u06CC\u0634 "),i()()()),r&2){let t=e.$implicit;l(2),z(t.party_name),l(2),z(t.fin_year),l(2),D("",t.detail.percentage,"%"),l(2),z(t.description||"-"),l(2),z(t.date)}}function Ye(r,e){if(r&1&&m(0,"nz-option",30),r&2){let t=e.$implicit;p("nzValue",t.year)("nzLabel",t.year)}}function Ge(r,e){if(r&1&&m(0,"nz-option",30),r&2){let t=e.$implicit;p("nzValue",t.id)("nzLabel",t.name)}}function Be(r,e){if(r&1&&(S(0),n(1,"p",25),u(2,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062C\u062F\u06CC\u062F\u06CC \u0628\u0647 \u0633\u06CC\u0633\u062A\u0645 \u0627\u0636\u0627\u0641\u0647 \u06A9\u0646\u06CC\u062F"),i(),n(3,"form",26)(4,"nz-form-item")(5,"nz-form-label",27),u(6,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),i(),n(7,"nz-form-control",28)(8,"nz-select",29),g(9,Ye,1,2,"nz-option",30,Ve),i()()(),n(11,"nz-form-item")(12,"nz-form-label",27),u(13,"\u0633\u0627\u0632\u0645\u0627\u0646 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),i(),n(14,"nz-form-control",31)(15,"nz-select",32),g(16,Ge,1,2,"nz-option",30,Ae),i()()(),n(18,"nz-form-item")(19,"nz-form-label",27),u(20,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0647\u0632\u06CC\u0646\u0647 (%)"),i(),n(21,"nz-form-control",33),m(22,"input",34),i()(),n(23,"nz-form-item")(24,"nz-form-label"),u(25,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),i(),n(26,"nz-form-control"),m(27,"textarea",35),i()()(),M()),r&2){let t=A();l(3),p("formGroup",t.fundForm),l(6),_(t.financialYears),l(7),_(t.organizations)}}var Pe=class r{constructor(e,t,o){this.fb=e;this.notification=t;this.http=o}isModalVisible=!1;fundForm;ORG_RESERVE_TYPE_ID=1;stats=[{title:"\u06A9\u0644 \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u0633\u0627\u0632\u0645\u0627\u0646 \u0647\u0627",value:"0",icon:"percentage"},{title:"\u0645\u06CC\u0627\u0646\u06AF\u06CC\u0646 \u062F\u0631\u0635\u062F",value:"0%",icon:"percentage"},{title:"\u0633\u0627\u0632\u0645\u0627\u0646 \u0647\u0627\u06CC \u062A\u062D\u062A \u067E\u0648\u0634\u0634",value:"0",icon:"file-text"}];displayReserves=[];financialYears=[];organizations=[];contributionApi=h.endpoints.contribution;contributionDetailApi=h.endpoints.contributionDetail;financialYearApi=h.endpoints.financialYear;organizationApi=h.endpoints.organization;ngOnInit(){this.loadInitialData(),this.fundForm=this.fb.group({fin_year:[null,[c.required]],party_id:[null,[c.required]],percentage:[null,[c.required,c.min(0),c.max(100)]],description:[null]})}loadInitialData(){O({contributions:this.http.get(this.contributionApi),details:this.http.get(this.contributionDetailApi),financialYears:this.http.get(this.financialYearApi),organizations:this.http.get(this.organizationApi)}).subscribe({next:e=>{this.financialYears=e.financialYears,this.organizations=e.organizations,this.processAndSetDisplayData(e.contributions,e.details)},error:e=>this.handleApiError("\u062F\u0631\u06CC\u0627\u0641\u062A \u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0627\u0648\u0644\u06CC\u0647",e)})}processAndSetDisplayData(e,t){let o=new Map(this.organizations.map(a=>[a.id,a.name])),s=e.filter(a=>a.contribution_type_id===this.ORG_RESERVE_TYPE_ID);this.displayReserves=s.map(a=>{let d=t.find(De=>De.contribution_id===a.id),Ne=o.get(a.party_id)||"\u0646\u0627\u0634\u0646\u0627\u062E\u062A\u0647";return x(F({},a),{party_name:Ne,detail:d})}).filter(a=>a.detail),this.updateStats()}updateStats(){this.stats[0].value=this.displayReserves.length.toString();let e=new Set(this.displayReserves.map(t=>t.party_id)).size;if(this.stats[2].value=e.toString(),this.displayReserves.length>0){let o=this.displayReserves.reduce((s,a)=>s+(a.detail.percentage||0),0)/this.displayReserves.length;this.stats[1].value=`${o.toFixed(2)}%`}else this.stats[1].value="0%"}showModal(){this.fundForm.reset(),this.isModalVisible=!0}handleOk(){if(this.fundForm.valid){let e=this.fundForm.value,t={party_type:"organization",party_id:e.party_id,fin_year:e.fin_year,contribution_type_id:this.ORG_RESERVE_TYPE_ID,date:new Date().toISOString().split("T")[0],total_amount:0,description:e.description};this.http.post(this.contributionApi,t).subscribe({next:o=>{let s={contribution_id:o.id,party_id:2,amount:0,percentage:e.percentage,amnt_or_prcntg:!0};this.http.post(this.contributionDetailApi,s).subscribe({next:()=>{this.notification.success("\u0645\u0648\u0641\u0642","\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062C\u062F\u06CC\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0630\u062E\u06CC\u0631\u0647 \u0634\u062F."),this.isModalVisible=!1,this.loadInitialData()},error:a=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u062C\u0632\u0626\u06CC\u0627\u062A \u0633\u0647\u0645",a)})},error:o=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u0633\u0647\u0645 \u0627\u0635\u0644\u06CC",o)})}else Object.values(this.fundForm.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))})}handleApiError(e,t){this.notification.error("\u062E\u0637\u0627",`${e} \u0628\u0627 \u0645\u0634\u06A9\u0644 \u0645\u0648\u0627\u062C\u0647 \u0634\u062F.`),console.error(t)}handleCancel(){this.isModalVisible=!1}static \u0275fac=function(t){return new(t||r)(v(ne),v(ge),v(B))};static \u0275cmp=E({type:r,selectors:[["app-org-reserve-percentage"]],features:[w([Y])],decls:47,vars:8,consts:[["suffixIconSearch",""],["fundsTable",""],[1,"fund-percentage-page"],["class.page-header",""],[1,"header-title"],[1,"header-actions"],[1,"dark-search-input"],["nzSearch","",3,"nzAddOnAfter"],["type","text","nz-input","","placeholder","\u062C\u0633\u062A\u062C\u0648\u06CC \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647..."],["nz-button","","nzType","primary","nzShape","round",3,"click"],["nz-icon","","nzType","plus"],[1,"stats-container"],[3,"icon","title","value","subtitle"],[1,"custom-card"],[1,"custom-card__header"],[1,"custom-card__title"],[1,"custom-card__subtitle"],[1,"custom-card__body"],[1,"financial-table",3,"nzData","nzSize","nzScroll"],[1,"actions-header"],["nzTitle","\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062C\u062F\u06CC\u062F",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzOkText","nzCancelText"],[4,"nzModalContent"],["nz-icon","","nzType","search"],[1,"actions"],["nz-button","","nzShape","round","nzType","primary","nzSize","small"],[1,"modal-subtitle"],["nz-form","",1,"modal-form",3,"formGroup"],["nzRequired",""],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","fin_year","nzPlaceHolder","\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],[3,"nzValue","nzLabel"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0633\u0627\u0632\u0645\u0627\u0646 \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","party_id","nzPlaceHolder","\u0633\u0627\u0632\u0645\u0627\u0646 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u06CC\u06A9 \u062F\u0631\u0635\u062F \u0645\u0639\u062A\u0628\u0631 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F"],["nz-input","","formControlName","percentage","type","number","placeholder","\u0645\u062B\u0627\u0644: 5.5"],["nz-input","","formControlName","description","placeholder","\u062A\u0648\u0636\u06CC\u062D\u0627\u062A \u0627\u062E\u062A\u06CC\u0627\u0631\u06CC"]],template:function(t,o){if(t&1){let s=P();n(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1"),u(4,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u0633\u0627\u0632\u0645\u0627\u0646 \u0647\u0627"),i(),n(5,"p"),u(6,"\u0645\u062F\u06CC\u0631\u06CC\u062A \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0647\u0632\u06CC\u0646\u0647 \u0628\u0631\u0627\u06CC \u0633\u0627\u0632\u0645\u0627\u0646 \u0647\u0627\u06CC \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),i()(),n(7,"div",5)(8,"div",6)(9,"nz-input-group",7),m(10,"input",8),i(),y(11,we,1,0,"ng-template",null,0,k),i(),n(13,"button",9),b("click",function(){return C(s),f(o.showModal())}),m(14,"span",10),u(15," \u062F\u0631\u0635\u062F \u062C\u062F\u06CC\u062F "),i()()(),n(16,"div",11),g(17,Ie,1,4,"app-status-card",12,Re),i(),n(19,"div",13)(20,"div",14)(21,"h2",15),u(22,"\u0644\u06CC\u0633\u062A \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u0633\u0627\u0632\u0645\u0627\u0646 \u0647\u0627"),i(),n(23,"p",16),u(24," \u062A\u0645\u0627\u0645 \u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0630\u062E\u06CC\u0631\u0647 \u062A\u0639\u0631\u06CC\u0641 \u0634\u062F\u0647 \u0628\u0631\u0627\u06CC \u0633\u0627\u0632\u0645\u0627\u0646 \u0647\u0627\u06CC \u0634\u0647\u0631\u062F\u0627\u0631\u06CC "),i()(),n(25,"div",17)(26,"nz-table",18,1)(28,"thead")(29,"tr")(30,"th"),u(31,"\u0633\u0627\u0632\u0645\u0627\u0646 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),i(),n(32,"th"),u(33,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),i(),n(34,"th"),u(35,"\u062F\u0631\u0635\u062F \u0635\u0646\u062F\u0648\u0642 \u0647\u0632\u06CC\u0646\u0647"),i(),n(36,"th"),u(37,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),i(),n(38,"th"),u(39,"\u062A\u0627\u0631\u06CC\u062E \u0627\u06CC\u062C\u0627\u062F"),i(),n(40,"th",19),u(41,"\u0639\u0645\u0644\u06CC\u0627\u062A"),i()()(),n(42,"tbody"),g(43,ke,14,5,"tr",null,Ae),i()()()()(),n(45,"nz-modal",20),V("nzVisibleChange",function(d){return C(s),R(o.isModalVisible,d)||(o.isModalVisible=d),f(d)}),b("nzOnCancel",function(){return C(s),f(o.handleCancel())})("nzOnOk",function(){return C(s),f(o.handleOk())}),y(46,Be,28,1,"ng-container",21),i()}if(t&2){let s=N(12);l(9),p("nzAddOnAfter",s),l(8),_(o.stats),l(9),p("nzData",o.displayReserves)("nzSize","middle")("nzScroll",I(7,Te)),l(17),_(o.displayReserves),l(2),T("nzVisible",o.isModalVisible),p("nzOkText","\u0630\u062E\u06CC\u0631\u0647")("nzCancelText","\u0627\u0646\u0635\u0631\u0627\u0641")}},dependencies:[G,ue,Z,Q,ee,U,X,re,te,ie,W,L,q,H,j,$,ce,me,pe,Fe,ve,_e,ze,be,he,ye,fe,Ce,de,Me,K,J,Oe,xe,Se,Ee,le,oe,ae,se],styles:[".bus-transit-share-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:2rem;height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1.5rem}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0 0}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.dark-search-input[_ngcontent-%COMP%]{min-width:250px}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem;padding:1.5rem;border-radius:8px}.stat-card__icon[_ngcontent-%COMP%]{font-size:2rem}.stat-card__info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-card__title[_ngcontent-%COMP%]{font-size:.9rem}.stat-card__value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600}.custom-card[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.custom-card__body[_ngcontent-%COMP%]{overflow-x:auto}.financial-table[_ngcontent-%COMP%]   .actions-header[_ngcontent-%COMP%]{text-align:center}.financial-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem;flex-wrap:nowrap}.modal-subtitle[_ngcontent-%COMP%]{color:#94a3b8;margin-top:-10px;margin-bottom:24px}"]})};export{Pe as OrgReservePercentageComponent};
