import{b as he}from"./chunk-EBMRRYIP.js";import{c as de}from"./chunk-FSSZSAII.js";import{a as be,b as ve,c as xe,d as Ae,e as Ee,f as Ne,g as Fe,h as Me,i as Oe,j as Te}from"./chunk-PHG3VJEM.js";import"./chunk-HNORQ23J.js";import"./chunk-2SBPQ5PO.js";import{a as De,b as Pe,c as Ve,d as we,e as Ie}from"./chunk-TS3NV7FJ.js";import{a as me,b as se,c as ce}from"./chunk-Y7V7LVZY.js";import"./chunk-K62VDMMU.js";import{a as X,b as Z}from"./chunk-JLK6BMKQ.js";import"./chunk-3GG5JXOG.js";import{a as ze,b as ge,c as ye}from"./chunk-POH2GVPE.js";import{a as _}from"./chunk-DEEABJD6.js";import{f as Ce,g as fe,h as _e}from"./chunk-BEYQRRZ4.js";import"./chunk-EWNZSDQ6.js";import{b as Se}from"./chunk-BVLOTES5.js";import{$ as le,L as ee,M as d,O as te,P as ie,S as ne,T as re,V as ae,X as oe,_ as ue,aa as pe}from"./chunk-KM43CBUV.js";import{f as J,g as K,h as Q,i as U}from"./chunk-4RJVJPSO.js";import{q as b,r as j,x as q,xa as B,ya as W}from"./chunk-7PNVVBYH.js";import"./chunk-MHGKYAZL.js";import"./chunk-FHD2U5CN.js";import{Ca as h,Da as z,Ec as A,Fb as T,Fc as a,Gc as S,H as O,Ic as I,Jc as R,Kc as k,Lb as y,Lc as Y,Mc as L,Nc as G,Qc as H,Tb as m,Tc as $,Uc as E,a as F,ac as D,b as M,dc as C,ec as f,fc as n,gc as i,hc as s,ic as P,jc as V,lc as w,rb as l,rc as x,tc as v,wb as g}from"./chunk-Q7WSBUFH.js";var Le=()=>({x:"800px"}),Ge=(r,e)=>e.title,N=(r,e)=>e.id,He=(r,e)=>e.year;function $e(r,e){r&1&&s(0,"span",23)}function je(r,e){if(r&1&&s(0,"app-status-card",13),r&2){let t=e.$implicit;m("title",t.title)("value",t.value)("icon",t.icon)("subtitle","")}}function qe(r,e){if(r&1&&(n(0,"tr")(1,"td"),a(2),i(),n(3,"td"),a(4),i(),n(5,"td"),a(6),H(7,"currency"),i(),n(8,"td"),a(9),i(),n(10,"td"),a(11),i(),n(12,"td",24)(13,"button",25),a(14," \u0648\u06CC\u0631\u0627\u06CC\u0634 "),i()()()),r&2){let t=e.$implicit;l(2),S(t.party_name),l(2),S(t.fin_year),l(2),I(" ",t.detail.amnt_or_prcntg?t.detail.percentage:$(7,6,t.detail.amount,"IRR","","1.0-0")," ",t.detail.amnt_or_prcntg?"%":"\u0631\u06CC\u0627\u0644"," "),l(3),S(t.description||"-"),l(2),S(t.date)}}function Be(r,e){if(r&1&&s(0,"nz-option",31),r&2){let t=e.$implicit;m("nzValue",t.year)("nzLabel",t.year)}}function We(r,e){if(r&1&&s(0,"nz-option",31),r&2){let t=e.$implicit;m("nzValue",t.id)("nzLabel",t.name)}}function Je(r,e){if(r&1&&C(0,We,1,2,"nz-option",31,N),r&2){let t=v(2);f(t.regions)}}function Ke(r,e){if(r&1&&s(0,"nz-option",31),r&2){let t=e.$implicit;m("nzValue",t.id)("nzLabel",t.name)}}function Qe(r,e){if(r&1&&C(0,Ke,1,2,"nz-option",31,N),r&2){let t=v(2);f(t.organizations)}}function Ue(r,e){r&1&&(n(0,"nz-select",41),s(1,"nz-option",42)(2,"nz-option",43),i()),r&2&&(l(),m("nzValue",!1),l(),m("nzValue",!0))}function Xe(r,e){if(r&1&&(P(0),n(1,"p",26),a(2,"\u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632 \u062C\u062F\u06CC\u062F\u06CC \u0628\u0647 \u0633\u06CC\u0633\u062A\u0645 \u0627\u0636\u0627\u0641\u0647 \u06A9\u0646\u06CC\u062F"),i(),n(3,"form",27)(4,"nz-form-item")(5,"nz-form-label",28),a(6,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),i(),n(7,"nz-form-control",29)(8,"nz-select",30),C(9,Be,1,2,"nz-option",31,He),i()()(),n(11,"nz-form-item")(12,"nz-form-label",28),a(13,"\u0646\u0648\u0639 \u0637\u0631\u0641 \u062D\u0633\u0627\u0628"),i(),n(14,"nz-form-control")(15,"nz-radio-group",32)(16,"label",33),a(17,"\u0645\u0646\u0637\u0642\u0647"),i(),n(18,"label",34),a(19,"\u0633\u0627\u0632\u0645\u0627\u0646"),i()()()(),n(20,"nz-form-item")(21,"nz-form-label",28),a(22,"\u0627\u0646\u062A\u062E\u0627\u0628 \u0637\u0631\u0641 \u062D\u0633\u0627\u0628"),i(),n(23,"nz-form-control",35)(24,"nz-select",36),y(25,Je,2,0)(26,Qe,2,0),i()()(),n(27,"nz-form-item")(28,"nz-form-label",28),a(29,"\u0645\u0642\u062F\u0627\u0631"),i(),n(30,"nz-form-control",37)(31,"nz-input-group",38),s(32,"input",39),i(),y(33,Ue,3,2,"ng-template",null,2,E),i()(),n(35,"nz-form-item")(36,"nz-form-label"),a(37,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),i(),n(38,"nz-form-control"),s(39,"textarea",40),i()()(),V()),r&2){let t=A(34),o=v();l(3),m("formGroup",o.shareForm),l(6),f(o.financialYears),l(16),D(o.shareForm.value.party_type==="region"?25:26),l(6),m("nzAddOnAfter",t)}}var Re=class r{constructor(e,t,o,p){this.fb=e;this.notification=t;this.http=o;this.currencyPipe=p}isModalVisible=!1;shareForm;CENTRAL_SHARE_TYPE_ID=3;stats=[{title:"\u06A9\u0644 \u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632",value:"0",icon:"schedule"},{title:"\u0645\u06CC\u0627\u0646\u06AF\u06CC\u0646 \u0645\u0642\u0627\u062F\u06CC\u0631",value:"0",icon:"clock-circle"},{title:"\u0645\u0646\u0627\u0637\u0642 \u0628\u0631\u062E\u0648\u0631\u062F\u0627\u0631",value:"0",icon:"file-text"}];displayShares=[];financialYears=[];regions=[];organizations=[];contributionApi=_.endpoints.contribution;contributionDetailApi=_.endpoints.contributionDetail;financialYearApi=_.endpoints.financialYear;regionApi=_.endpoints.region;organizationApi=_.endpoints.organization;ngOnInit(){this.loadInitialData(),this.shareForm=this.fb.group({fin_year:[null,[d.required]],party_type:["region",[d.required]],party_id:[null,[d.required]],value:[null,[d.required,d.min(0)]],amnt_or_prcntg:[!1,[d.required]],description:[null]})}loadInitialData(){O({contributions:this.http.get(this.contributionApi),details:this.http.get(this.contributionDetailApi),financialYears:this.http.get(this.financialYearApi),regions:this.http.get(this.regionApi),organizations:this.http.get(this.organizationApi)}).subscribe({next:e=>{this.financialYears=e.financialYears,this.regions=e.regions,this.organizations=e.organizations,this.processAndSetDisplayData(e.contributions,e.details)},error:e=>this.handleApiError("\u062F\u0631\u06CC\u0627\u0641\u062A \u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0627\u0648\u0644\u06CC\u0647",e)})}processAndSetDisplayData(e,t){let o=new Map;o.set("region",new Map(this.regions.map(u=>[u.id,u.name]))),o.set("organization",new Map(this.organizations.map(u=>[u.id,u.name])));let p=e.filter(u=>u.contribution_type_id===this.CENTRAL_SHARE_TYPE_ID);this.displayShares=p.map(u=>{let c=t.find(Ye=>Ye.contribution_id===u.id),ke=o.get(u.party_type)?.get(u.party_id)||"\u0646\u0627\u0634\u0646\u0627\u062E\u062A\u0647";return M(F({},u),{party_name:ke,detail:c})}).filter(u=>u.detail),this.updateStats()}updateStats(){this.stats[0].value=this.displayShares.length.toString();let e=new Set(this.displayShares.map(t=>t.party_id)).size;if(this.stats[2].value=e.toString(),this.displayShares.length>0){let o=this.displayShares.reduce((p,u)=>p+u.detail.amount+(u.detail.percentage||0),0)/this.displayShares.length;this.stats[1].value=`${o.toFixed(2)}`}else this.stats[1].value="0"}showModal(){this.shareForm.reset({party_type:"region",amnt_or_prcntg:!1}),this.isModalVisible=!0}handleOk(){if(this.shareForm.valid){let e=this.shareForm.value,t={party_type:e.party_type,party_id:3,fin_year:e.fin_year,contribution_type_id:this.CENTRAL_SHARE_TYPE_ID,date:new Date().toISOString().split("T")[0],total_amount:e.amnt_or_prcntg?0:e.value,description:e.description};this.http.post(this.contributionApi,t).subscribe({next:o=>{let p=e.amnt_or_prcntg,u={contribution_id:o.id,party_id:3,amount:p?0:e.value,percentage:p?e.value:0,amnt_or_prcntg:p};this.http.post(this.contributionDetailApi,u).subscribe({next:()=>{this.notification.success("\u0645\u0648\u0641\u0642","\u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632 \u062C\u062F\u06CC\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0630\u062E\u06CC\u0631\u0647 \u0634\u062F."),this.isModalVisible=!1,this.loadInitialData()},error:c=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u062C\u0632\u0626\u06CC\u0627\u062A \u0633\u0647\u0645",c)})},error:o=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u0633\u0647\u0645 \u0627\u0635\u0644\u06CC",o)})}else Object.values(this.shareForm.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))})}handleApiError(e,t){this.notification.error("\u062E\u0637\u0627",`${e} \u0628\u0627 \u0645\u0634\u06A9\u0644 \u0645\u0648\u0627\u062C\u0647 \u0634\u062F.`),console.error(t)}handleCancel(){this.isModalVisible=!1}static \u0275fac=function(t){return new(t||r)(g(ue),g(Se),g(q),g(b))};static \u0275cmp=T({type:r,selectors:[["app-central-share"]],features:[L([b])],decls:47,vars:8,consts:[["suffixIconSearch",""],["sharesTable",""],["suffixTemplate",""],[1,"centralized-share-page"],[1,"page-header"],[1,"header-title"],[1,"header-actions"],[1,"dark-search-input"],["nzSearch","",3,"nzAddOnAfter"],["type","text","nz-input","","placeholder","\u062C\u0633\u062A\u062C\u0648\u06CC \u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632..."],["nz-button","","nzType","primary","nzShape","round",3,"click"],["nz-icon","","nzType","plus"],[1,"stats-container"],[3,"title","value","icon","subtitle"],[1,"custom-card"],[1,"custom-card__header"],[1,"custom-card__title"],[1,"custom-card__subtitle"],[1,"custom-card__body"],[1,"financial-table",3,"nzData","nzSize","nzScroll"],[1,"actions-header"],["nzTitle","\u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632 \u062C\u062F\u06CC\u062F",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzOkText","nzCancelText"],[4,"nzModalContent"],["nz-icon","","nzType","search"],[1,"actions"],["nz-button","","nzShape","round","nzType","primary","nzSize","small"],[1,"modal-subtitle"],["nz-form","",1,"modal-form",3,"formGroup"],["nzRequired",""],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","fin_year","nzPlaceHolder","\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],[3,"nzValue","nzLabel"],["formControlName","party_type"],["nz-radio-button","","nzValue","region"],["nz-radio-button","","nzValue","organization"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u06CC\u06A9 \u0645\u0648\u0631\u062F \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","party_id","nzPlaceHolder","\u0637\u0631\u0641 \u062D\u0633\u0627\u0628 \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0645\u0642\u062F\u0627\u0631 \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F"],[3,"nzAddOnAfter"],["type","number","nz-input","","formControlName","value"],["nz-input","","formControlName","description","placeholder","\u062A\u0648\u0636\u06CC\u062D\u0627\u062A \u0627\u062E\u062A\u06CC\u0627\u0631\u06CC"],["formControlName","amnt_or_prcntg",1,"select-after"],["nzLabel","\u0631\u06CC\u0627\u0644",3,"nzValue"],["nzLabel","%",3,"nzValue"]],template:function(t,o){if(t&1){let p=w();n(0,"div",3)(1,"div",4)(2,"div",5)(3,"h1"),a(4,"\u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632"),i(),n(5,"p"),a(6,"\u0645\u062F\u06CC\u0631\u06CC\u062A \u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632 \u0628\u0631\u0627\u06CC \u0645\u0646\u0627\u0637\u0642 \u0628\u0631\u062E\u0648\u0631\u062F\u0627\u0631 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),i()(),n(7,"div",6)(8,"div",7)(9,"nz-input-group",8),s(10,"input",9),i(),y(11,$e,1,0,"ng-template",null,0,E),i(),n(13,"button",10),x("click",function(){return h(p),z(o.showModal())}),s(14,"span",11),a(15," \u0633\u0647\u0645 \u062C\u062F\u06CC\u062F "),i()()(),n(16,"div",12),C(17,je,1,4,"app-status-card",13,Ge),i(),n(19,"div",14)(20,"div",15)(21,"h2",16),a(22,"\u0644\u06CC\u0633\u062A \u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632"),i(),n(23,"p",17),a(24," \u062A\u0645\u0627\u0645 \u0633\u0647\u0645 \u0645\u062A\u0645\u0631\u06A9\u0632 \u062A\u0639\u0631\u06CC\u0641 \u0634\u062F\u0647 \u0628\u0631\u0627\u06CC \u0645\u0646\u0627\u0637\u0642 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC "),i()(),n(25,"div",18)(26,"nz-table",19,1)(28,"thead")(29,"tr")(30,"th"),a(31,"\u0637\u0631\u0641 \u062D\u0633\u0627\u0628 (\u0645\u0646\u0637\u0642\u0647/\u0633\u0627\u0632\u0645\u0627\u0646)"),i(),n(32,"th"),a(33,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),i(),n(34,"th"),a(35,"\u0645\u0642\u062F\u0627\u0631"),i(),n(36,"th"),a(37,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),i(),n(38,"th"),a(39,"\u062A\u0627\u0631\u06CC\u062E \u0627\u06CC\u062C\u0627\u062F"),i(),n(40,"th",20),a(41,"\u0639\u0645\u0644\u06CC\u0627\u062A"),i()()(),n(42,"tbody"),C(43,qe,15,11,"tr",null,N),i()()()()(),n(45,"nz-modal",21),Y("nzVisibleChange",function(c){return h(p),k(o.isModalVisible,c)||(o.isModalVisible=c),z(c)}),x("nzOnCancel",function(){return h(p),z(o.handleCancel())})("nzOnOk",function(){return h(p),z(o.handleOk())}),y(46,Xe,40,3,"ng-container",22),i()}if(t&2){let p=A(12);l(9),m("nzAddOnAfter",p),l(8),f(o.stats),l(9),m("nzData",o.displayShares)("nzSize","middle")("nzScroll",G(7,Le)),l(17),f(o.displayShares),l(2),R("nzVisible",o.isModalVisible),m("nzOkText","\u0630\u062E\u06CC\u0631\u0647")("nzCancelText","\u0627\u0646\u0635\u0631\u0627\u0641")}},dependencies:[j,b,le,ne,ee,re,te,ie,pe,ae,oe,U,Q,J,K,W,B,_e,Ce,fe,he,Te,Fe,Ae,Ee,Oe,Ne,Me,ye,ge,ze,Ie,Z,X,Pe,De,we,Ve,ce,me,se,de,xe,ve,be],styles:[".central-share-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:2rem;height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1.5rem}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0 0}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.dark-search-input[_ngcontent-%COMP%]{min-width:250px}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.custom-card[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.custom-card__body[_ngcontent-%COMP%]{overflow-x:auto}.financial-table[_ngcontent-%COMP%]   .actions-header[_ngcontent-%COMP%]{text-align:center}.financial-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem;flex-wrap:nowrap}.modal-subtitle[_ngcontent-%COMP%]{margin-top:-10px;margin-bottom:24px}.modal-form[_ngcontent-%COMP%]   .full-width-input[_ngcontent-%COMP%]{width:100%}.modal-form[_ngcontent-%COMP%]   .select-after[_ngcontent-%COMP%]{width:80px}"]})};export{Re as CentralShareComponent};
