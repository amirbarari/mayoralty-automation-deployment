import{c as Ce}from"./chunk-FSSZSAII.js";import{a as Se,b as ve,c as xe,d as Ae,e as Ee,f as Me,g as Fe,h as Ne,i as Oe,j as De}from"./chunk-WRUICC57.js";import"./chunk-S76HEK6X.js";import"./chunk-2SBPQ5PO.js";import{a as Pe,b as Te,c as Ve,d as we,e as Ie}from"./chunk-YOIS5LYM.js";import{a as pe,b as ce,c as de}from"./chunk-GAPH4TJR.js";import"./chunk-K62VDMMU.js";import{a as Z,b as ee}from"./chunk-JLK6BMKQ.js";import"./chunk-3GG5JXOG.js";import{a as ze,b as ge,c as ye}from"./chunk-S6C6MKMF.js";import{a as f}from"./chunk-DEEABJD6.js";import{f as fe,g as _e,h as he}from"./chunk-UQPNZCHR.js";import"./chunk-PZ3WQJJL.js";import{b as be}from"./chunk-R7V4VY4G.js";import{$ as le,L as te,M as C,O as ie,P as ne,T as re,U as ue,W as oe,Y as ae,aa as se,ba as me}from"./chunk-WURTGZ7Q.js";import{f as J,g as K,h as Q,i as X}from"./chunk-4RJVJPSO.js";import{A as q,q as b,r as $,x as L,xa as W,ya as U}from"./chunk-7PNVVBYH.js";import"./chunk-MHGKYAZL.js";import"./chunk-FHD2U5CN.js";import{Ca as h,Da as z,Ec as V,Fb as N,Fc as u,Gc as y,H as F,Hc as w,Jc as I,Kc as B,Lb as S,Lc as R,Mc as k,Nc as Y,Qc as H,Tb as p,Tc as G,Uc as j,a as E,ac as O,b as M,dc as c,ec as d,fc as n,gc as i,hc as m,ic as D,jc as P,lc as T,rb as l,rc as x,tc as v,wb as g}from"./chunk-Q7WSBUFH.js";var Ye=()=>({x:"800px"}),He=(r,e)=>e.title,A=(r,e)=>e.id,Ge=(r,e)=>e.year;function je(r,e){r&1&&m(0,"span",22)}function $e(r,e){if(r&1&&m(0,"app-status-card",12),r&2){let t=e.$implicit;p("title",t.title)("value",t.value)("icon",t.icon)("subtitle","")}}function Le(r,e){if(r&1&&(n(0,"tr")(1,"td"),u(2),i(),n(3,"td"),u(4),i(),n(5,"td"),u(6),H(7,"currency"),i(),n(8,"td"),u(9),i(),n(10,"td"),u(11),i(),n(12,"td",23)(13,"button",24),u(14," \u0648\u06CC\u0631\u0627\u06CC\u0634 "),i()()()),r&2){let t=e.$implicit;l(2),y(t.party_name),l(2),y(t.fin_year),l(2),w(" ",G(7,5,t.total_amount,"IRR","","1.0-0")," \u0631\u06CC\u0627\u0644 "),l(3),y(t.description||"-"),l(2),y(t.date)}}function qe(r,e){if(r&1&&m(0,"nz-option",30),r&2){let t=e.$implicit;p("nzValue",t.year)("nzLabel",t.year)}}function We(r,e){if(r&1&&m(0,"nz-option",30),r&2){let t=e.$implicit;p("nzValue",t.id)("nzLabel",t.name)}}function Ue(r,e){if(r&1&&c(0,We,1,2,"nz-option",30,A),r&2){let t=v(2);d(t.regions)}}function Je(r,e){if(r&1&&m(0,"nz-option",30),r&2){let t=e.$implicit;p("nzValue",t.id)("nzLabel",t.name)}}function Ke(r,e){if(r&1&&c(0,Je,1,2,"nz-option",30,A),r&2){let t=v(2);d(t.organizations)}}function Qe(r,e){if(r&1&&(D(0),n(1,"p",25),u(2,"\u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC \u062C\u062F\u06CC\u062F\u06CC \u0628\u0647 \u0633\u06CC\u0633\u062A\u0645 \u0627\u0636\u0627\u0641\u0647 \u06A9\u0646\u06CC\u062F"),i(),n(3,"form",26)(4,"nz-form-item")(5,"nz-form-label",27),u(6,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),i(),n(7,"nz-form-control",28)(8,"nz-select",29),c(9,qe,1,2,"nz-option",30,Ge),i()()(),n(11,"nz-form-item")(12,"nz-form-label",27),u(13,"\u0646\u0648\u0639 \u0637\u0631\u0641 \u062D\u0633\u0627\u0628"),i(),n(14,"nz-form-control")(15,"nz-radio-group",31)(16,"label",32),u(17,"\u0645\u0646\u0637\u0642\u0647"),i(),n(18,"label",33),u(19,"\u0633\u0627\u0632\u0645\u0627\u0646"),i()()()(),n(20,"nz-form-item")(21,"nz-form-label",27),u(22,"\u0627\u0646\u062A\u062E\u0627\u0628 \u0637\u0631\u0641 \u062D\u0633\u0627\u0628"),i(),n(23,"nz-form-control",34)(24,"nz-select",35),S(25,Ue,2,0)(26,Ke,2,0),i()()(),n(27,"nz-form-item")(28,"nz-form-label",27),u(29,"\u0645\u0628\u0644\u063A \u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC (\u0631\u06CC\u0627\u0644)"),i(),n(30,"nz-form-control",36),m(31,"input",37),i()(),n(32,"nz-form-item")(33,"nz-form-label"),u(34,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),i(),n(35,"nz-form-control"),m(36,"textarea",38),i()()(),P()),r&2){let t=v();l(3),p("formGroup",t.shareForm),l(6),d(t.financialYears),l(16),O(t.shareForm.value.party_type==="region"?25:26)}}var Be=class r{constructor(e,t,o,s){this.fb=e;this.notification=t;this.http=o;this.currencyPipe=s}isModalVisible=!1;shareForm;BUS_SHARE_TYPE_ID=2;stats=[{title:"\u06A9\u0644 \u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC",value:"0",icon:"car"},{title:"\u0645\u062C\u0645\u0648\u0639 \u0645\u0628\u0627\u0644\u063A",value:"\u06F0 \u0631\u06CC\u0627\u0644",icon:"money-collect"},{title:"\u0645\u06CC\u0627\u0646\u06AF\u06CC\u0646 \u0645\u0628\u0644\u063A",value:"\u06F0 \u0631\u06CC\u0627\u0644",icon:"fund"}];displayShares=[];financialYears=[];regions=[];organizations=[];contributionApi=f.endpoints.contribution;contributionDetailApi=f.endpoints.contributionDetail;financialYearApi=f.endpoints.financialYear;regionApi=f.endpoints.region;organizationApi=f.endpoints.organization;ngOnInit(){this.loadInitialData(),this.shareForm=this.fb.group({fin_year:[null,[C.required]],party_type:["region",[C.required]],party_id:[null,[C.required]],amount:[null,[C.required,C.min(0)]],description:[null]})}loadInitialData(){F({contributions:this.http.get(this.contributionApi),details:this.http.get(this.contributionDetailApi),financialYears:this.http.get(this.financialYearApi),regions:this.http.get(this.regionApi),organizations:this.http.get(this.organizationApi)}).subscribe({next:e=>{this.financialYears=e.financialYears,this.regions=e.regions,this.organizations=e.organizations,this.processAndSetDisplayData(e.contributions,e.details)},error:e=>this.handleApiError("\u062F\u0631\u06CC\u0627\u0641\u062A \u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0627\u0648\u0644\u06CC\u0647",e)})}processAndSetDisplayData(e,t){let o=new Map;o.set("region",new Map(this.regions.map(a=>[a.id,a.name]))),o.set("organization",new Map(this.organizations.map(a=>[a.id,a.name])));let s=e.filter(a=>a.contribution_type_id===this.BUS_SHARE_TYPE_ID);this.displayShares=s.map(a=>{let _=t.find(ke=>ke.contribution_id===a.id),Re=o.get(a.party_type)?.get(a.party_id)||"\u0646\u0627\u0634\u0646\u0627\u062E\u062A\u0647";return M(E({},a),{party_name:Re,detail:_})}).filter(a=>a.detail),this.updateStats()}updateStats(){this.stats[0].value=this.displayShares.length.toString();let e=this.displayShares.reduce((t,o)=>t+o.total_amount,0);if(this.stats[1].value=this.currencyPipe.transform(e,"IRR","","1.0-0")||"\u06F0 \u0631\u06CC\u0627\u0644",this.displayShares.length>0){let t=e/this.displayShares.length;this.stats[2].value=this.currencyPipe.transform(t,"IRR","","1.0-0")||"\u06F0 \u0631\u06CC\u0627\u0644"}else this.stats[2].value="\u06F0 \u0631\u06CC\u0627\u0644"}showModal(){this.shareForm.reset({party_type:"region"}),this.isModalVisible=!0}handleOk(){if(this.shareForm.valid){let e=this.shareForm.value,t={party_type:e.party_type,party_id:e.party_id,fin_year:e.fin_year,contribution_type_id:this.BUS_SHARE_TYPE_ID,date:new Date().toISOString().split("T")[0],total_amount:e.amount,description:e.description};this.http.post(this.contributionApi,t).subscribe({next:o=>{let s={contribution_id:o.id,party_id:4,amount:e.amount,percentage:0,amnt_or_prcntg:!1};this.http.post(this.contributionDetailApi,s).subscribe({next:()=>{this.notification.success("\u0645\u0648\u0641\u0642","\u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC \u062C\u062F\u06CC\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0630\u062E\u06CC\u0631\u0647 \u0634\u062F."),this.isModalVisible=!1,this.loadInitialData()},error:a=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u062C\u0632\u0626\u06CC\u0627\u062A \u0633\u0647\u0645",a)})},error:o=>this.handleApiError("\u0627\u06CC\u062C\u0627\u062F \u0633\u0647\u0645 \u0627\u0635\u0644\u06CC",o)})}else Object.values(this.shareForm.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))})}handleApiError(e,t){this.notification.error("\u062E\u0637\u0627",`${e} \u0628\u0627 \u0645\u0634\u06A9\u0644 \u0645\u0648\u0627\u062C\u0647 \u0634\u062F.`),console.error(t)}handleCancel(){this.isModalVisible=!1}static \u0275fac=function(t){return new(t||r)(g(le),g(be),g(L),g(b))};static \u0275cmp=N({type:r,selectors:[["app-bus-share"]],features:[k([b])],decls:47,vars:8,consts:[["suffixIconSearch",""],["sharesTable",""],[1,"bus-share-page"],[1,"page-header"],[1,"header-title"],[1,"header-actions"],[1,"dark-search-input"],["nzSearch","",3,"nzAddOnAfter"],["type","text","nz-input","","placeholder","\u062C\u0633\u062A\u062C\u0648\u06CC \u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC..."],["nz-button","","nzType","primary","nzShape","round",3,"click"],["nz-icon","","nzType","plus"],[1,"stats-container"],[3,"title","value","icon","subtitle"],[1,"custom-card"],[1,"custom-card__header"],[1,"custom-card__title"],[1,"custom-card__subtitle"],[1,"custom-card__body"],[1,"financial-table",3,"nzData","nzSize","nzScroll"],[1,"actions-header"],["nzTitle","\u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC \u062C\u062F\u06CC\u062F",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzOkText","nzCancelText"],[4,"nzModalContent"],["nz-icon","","nzType","search"],[1,"actions"],["nz-button","","nzShape","round","nzType","primary","nzSize","small"],[1,"modal-subtitle"],["nz-form","",1,"modal-form",3,"formGroup"],["nzRequired",""],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","fin_year","nzPlaceHolder","\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],[3,"nzValue","nzLabel"],["formControlName","party_type"],["nz-radio-button","","nzValue","region"],["nz-radio-button","","nzValue","organization"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u06CC\u06A9 \u0645\u0648\u0631\u062F \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["formControlName","party_id","nzPlaceHolder","\u0637\u0631\u0641 \u062D\u0633\u0627\u0628 \u0631\u0627 \u0627\u0646\u062A\u062E\u0627\u0628 \u06A9\u0646\u06CC\u062F"],["nzErrorTip","\u0644\u0637\u0641\u0627 \u0645\u0628\u0644\u063A \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F"],["nz-input","","formControlName","amount","type","number","placeholder","\u0645\u062B\u0627\u0644: 1,000,000,000"],["nz-input","","formControlName","description","placeholder","\u062A\u0648\u0636\u06CC\u062D\u0627\u062A \u0627\u062E\u062A\u06CC\u0627\u0631\u06CC"]],template:function(t,o){if(t&1){let s=T();n(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1"),u(4,"\u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC"),i(),n(5,"p"),u(6,"\u0645\u062F\u06CC\u0631\u06CC\u062A \u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC \u0628\u0631\u0627\u06CC \u0645\u0646\u0627\u0637\u0642 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC"),i()(),n(7,"div",5)(8,"div",6)(9,"nz-input-group",7),m(10,"input",8),i(),S(11,je,1,0,"ng-template",null,0,j),i(),n(13,"button",9),x("click",function(){return h(s),z(o.showModal())}),m(14,"span",10),u(15," \u0633\u0647\u0645 \u062C\u062F\u06CC\u062F "),i()()(),n(16,"div",11),c(17,$e,1,4,"app-status-card",12,He),i(),n(19,"div",13)(20,"div",14)(21,"h2",15),u(22,"\u0644\u06CC\u0633\u062A \u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC"),i(),n(23,"p",16),u(24," \u062A\u0645\u0627\u0645 \u0633\u0647\u0645 \u0627\u062A\u0648\u0628\u0648\u0633\u0631\u0627\u0646\u06CC \u062A\u0639\u0631\u06CC\u0641 \u0634\u062F\u0647 \u0628\u0631\u0627\u06CC \u0645\u0646\u0627\u0637\u0642 \u0634\u0647\u0631\u062F\u0627\u0631\u06CC "),i()(),n(25,"div",17)(26,"nz-table",18,1)(28,"thead")(29,"tr")(30,"th"),u(31,"\u0637\u0631\u0641 \u062D\u0633\u0627\u0628 (\u0645\u0646\u0637\u0642\u0647/\u0633\u0627\u0632\u0645\u0627\u0646)"),i(),n(32,"th"),u(33,"\u0633\u0627\u0644 \u0645\u0627\u0644\u06CC"),i(),n(34,"th"),u(35,"\u0645\u0628\u0644\u063A \u0633\u0647\u0645"),i(),n(36,"th"),u(37,"\u062A\u0648\u0636\u06CC\u062D\u0627\u062A"),i(),n(38,"th"),u(39,"\u062A\u0627\u0631\u06CC\u062E \u0627\u06CC\u062C\u0627\u062F"),i(),n(40,"th",19),u(41,"\u0639\u0645\u0644\u06CC\u0627\u062A"),i()()(),n(42,"tbody"),c(43,Le,15,10,"tr",null,A),i()()()()(),n(45,"nz-modal",20),R("nzVisibleChange",function(_){return h(s),B(o.isModalVisible,_)||(o.isModalVisible=_),z(_)}),x("nzOnCancel",function(){return h(s),z(o.handleCancel())})("nzOnOk",function(){return h(s),z(o.handleOk())}),S(46,Qe,37,2,"ng-container",21),i()}if(t&2){let s=V(12);l(9),p("nzAddOnAfter",s),l(8),d(o.stats),l(9),p("nzData",o.displayShares)("nzSize","middle")("nzScroll",Y(7,Ye)),l(17),d(o.displayShares),l(2),I("nzVisible",o.isModalVisible),p("nzOkText","\u0630\u062E\u06CC\u0631\u0647")("nzCancelText","\u0627\u0646\u0635\u0631\u0627\u0641")}},dependencies:[$,b,q,se,re,te,ue,ie,ne,me,oe,ae,X,Q,J,K,U,W,he,fe,_e,De,Fe,Ae,Ee,Oe,Me,Ne,ye,ge,ze,Ie,ee,Z,Te,Pe,we,Ve,de,pe,ce,xe,ve,Se,Ce],styles:[".bus-transit-share-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:2rem;height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1.5rem}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0 0}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.dark-search-input[_ngcontent-%COMP%]{min-width:250px}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem;padding:1.5rem;border-radius:8px}.stat-card__icon[_ngcontent-%COMP%]{font-size:2rem}.stat-card__info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-card__title[_ngcontent-%COMP%]{font-size:.9rem}.stat-card__value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600}.custom-card[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.custom-card__body[_ngcontent-%COMP%]{overflow-x:auto}.financial-table[_ngcontent-%COMP%]   .actions-header[_ngcontent-%COMP%]{text-align:center}.financial-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem;flex-wrap:nowrap}.modal-subtitle[_ngcontent-%COMP%]{margin-top:-10px;margin-bottom:24px}"]})};export{Be as BusShareComponent};
